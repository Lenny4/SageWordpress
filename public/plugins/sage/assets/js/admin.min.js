jQuery(document).ready(function(){let o=jQuery("#filters_container"),j=jQuery("[data-sage-site-url]").attr("data-sage-site-url");var e=jQuery("[data-sage-translation]").attr("data-sage-translation");let Q=[],r=(e&&(Q=JSON.parse(e)),jQuery("[data-sage-js-translation]").attr("data-sage-js-translation")),t=(r=r&&JSON.parse(r),jQuery("[data-sage-api-host-url]").attr("data-sage-api-host-url")),a=new URL(location.href),i=(a.searchParams.delete("sage_message"),window.history.replaceState(null,"",a),0);function d(){return jQuery(o).children().length}function n(){var r,e=JSON.parse(jQuery("[data-all-fields]").attr("data-all-fields")),t=jQuery('<div class="filter-container" style="margin-bottom: 5px;display: flex;flex-wrap: wrap;"></div>').appendTo(o),a=jQuery("<div></div>").appendTo(t),n=(jQuery('<label class="screen-reader-text" for="filter_field['+i+']">filter_field[index]</label>').appendTo(a),jQuery('<select name="filter_field['+i+']" id="filter_field['+i+']"></select>').appendTo(a));jQuery("<option disabled selected value> -- select a field -- </option>").appendTo(n);for(r of e){let e=r.name;Q[r.transDomain].hasOwnProperty(r.name)&&"string"!=typeof(e=Q[r.transDomain][r.name])&&(e=e.label);jQuery('<option value="'+r.name+'">'+e+"</option>").appendTo(n)}var a=jQuery("<div></div>").appendTo(t),e=(jQuery('<label class="screen-reader-text" for="filter_type['+i+']">filter_type[index]</label>').appendTo(a),jQuery('<select disabled name="filter_type['+i+']" id="filter_type['+i+']"></select>').appendTo(a)),a=(jQuery("<option disabled selected value></option>").appendTo(e),jQuery("<div></div>").appendTo(t));jQuery('<label class="screen-reader-text" for="filter_value['+i+']">filter_value[index]</label>').appendTo(a),jQuery('<input disabled type="search" id="filter_value['+i+']" name="filter_value['+i+']" value="">').appendTo(a),jQuery('<span data-delete-filter class="dashicons dashicons-trash button" style="padding-right: 22px"></span>').appendTo(t);return i++,1<d()&&1!==jQuery("#where_condition").length&&(e=jQuery('<select name="where_condition" id="where_condition"></select>').appendTo("#or_and_container"),jQuery('<option value="or">or</option>').appendTo(e),jQuery('<option value="and">and</option>').appendTo(e)),t}function l(e){var r=JSON.parse(jQuery("[data-all-filter-type]").attr("data-all-filter-type")),t=JSON.parse(jQuery("[data-all-fields]").attr("data-all-fields"));let a=jQuery(e).find('select[name^="filter_field"]').val();var n=jQuery(e).find('select[name^="filter_type"]'),o=jQuery(e).find('input[name^="filter_value"]');jQuery(n).prop("disabled",!1),jQuery(o).prop("disabled",!1);let i=[];jQuery(n).find("option").each(function(e,r){i.push(jQuery(r).val())});t=t.find(e=>e.name===a).type,"DateTimeOperationFilterInput"===t&&jQuery(o).prop("type","date"),o=r[t];if(JSON.stringify(i)!==JSON.stringify(o)){jQuery(n).html("");for(var d of o){let e=d;Q.words.hasOwnProperty(d)&&(e=Q.words[d]);jQuery('<option value="'+d+'">'+e+"</option>").appendTo(n)}}u(e)}function s(e){var r=jQuery(e).find('input[name^="filter_value"]'),e=jQuery(e).find("select[data-filter-value-select]");jQuery(r).val(jQuery(e).val())}function u(e){var r=JSON.parse(jQuery("[data-all-fields]").attr("data-all-fields")),t=jQuery(e).find('input[name^="filter_value"]');let a=jQuery(e).find('select[name^="filter_field"]').val();var n=jQuery(e).find('select[name^="filter_type["]'),n=jQuery(n).val();let o="";["in","nin"].includes(n)&&(o="multiple");n=r.find(e=>e.name===a).values,r=jQuery(t).parent();jQuery(r).find("select").remove(),null!==n?(function r(t,a,n){for(var o in t){let e="";var i;n.includes(o.toString())&&(e='selected="selected"'),"string"==typeof t[o]?jQuery("<option "+e+' value="'+o+'">['+o+"]: "+t[o]+"</option>").appendTo(a):(i=jQuery('<optgroup label="'+o+'" />').appendTo(a),r(t[o],i,n))}}(n,jQuery("<select data-filter-value-select "+o+"></select>").appendTo(r),jQuery(t).val().split(",")),s(e)):jQuery(t).show()}function c(){var e=jQuery("[id^='woocommerce-order-sage']"),e=jQuery(e).find("[data-order-data]");return[jQuery(e).attr("data-order-id"),jQuery(e).attr("data-nonce")]}async function y(e){var r=jQuery("[id^='woocommerce-order-sage']"),[t,a]=(jQuery(r).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c());let n=j+"/index.php?rest_route="+encodeURI("/sage/v1/orders/"+t+"/sync")+"&_wpnonce="+a;e||(n=j+"/index.php?rest_route="+encodeURI("/sage/v1/orders/"+t+"/desynchronize")+"&_wpnonce="+a);e=await fetch(n);jQuery(r).unblock(),200===e.status&&(t=await e.json(),a=jQuery(r).find(".inside"),jQuery(a).html(t.html)),jQuery("#woocommerce-order-items").trigger("wc_order_items_reload"),p()}async function p(){var e=jQuery("#woocommerce-order-data"),[r,t]=(jQuery(e).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c()),r=await fetch(j+"/index.php?rest_route="+encodeURI("/sage/v1/orders/"+r+"/meta-box-order")+"&_wpnonce="+t);jQuery(e).unblock(),200===r.status&&(t=await r.json(),r=jQuery(e).find(".inside"),jQuery(r).html(t.html),jQuery(document.body).trigger("wc-enhanced-select-init"))}jQuery(document).on("click","[data-2-select-target] option",function(e){var r=jQuery(e.target).closest("select");let t;var a=jQuery(r).attr("name");let n=!1;t=(void 0!==a&&!1!==a?(n=!0,jQuery(r).parent().prev()):jQuery(r).parent().next()).find("select");a=jQuery(e.target).detach().appendTo(t);jQuery(a).prop("selected",!1),n&&((r=t.children("option").get()).sort(function(e,r){return jQuery(e).text().toUpperCase().localeCompare(jQuery(r).text().toUpperCase())}),jQuery.each(r,function(e,r){t.append(r)}))}),jQuery(document).on("submit","#form_settings_sage",function(e){jQuery(e.target).find("[data-2-select-target] option").prop("selected",!0)}),jQuery(document).on("click",".sage-notice-dismiss",function(e){jQuery(e.target).closest("div.notice").remove()}),jQuery(document).on("click","#add_filter",function(e){n()}),jQuery(document).on("change",'select[name^="filter_field["]',function(e){l(jQuery(e.target).closest(".filter-container"))}),jQuery(document).on("change",'select[name^="filter_type["]',function(e){u(jQuery(e.target).closest(".filter-container"))}),jQuery(document).on("change","select[data-filter-value-select]",function(e){s(jQuery(e.target).closest(".filter-container"))}),jQuery(document).on("change",'select[name="per_page"]',function(e){jQuery(e.target).closest("form").submit()}),jQuery(document).on("click","[data-delete-filter]",function(e){jQuery(e.target).closest(".filter-container").remove(),d()<=1&&jQuery("#or_and_container").html("")}),jQuery(document).on("input","#filter-sage *",function(e){jQuery(jQuery(e.target).parent()).find(".error-message").remove()}),jQuery(document).on("submit","#filter-sage",function(e){jQuery("#filter-sage").find(".error-message").remove(),jQuery(".filter-container").each(function(e,r){var t=jQuery(r).find('select[name^="filter_field["]'),a=jQuery(r).find('select[name^="filter_type["]'),r=jQuery(r).find('input[name^="filter_value["]'),n=jQuery(t).val(),o=(jQuery(a).val(),jQuery(r).val().trim()),t=jQuery(t).parent(),a=(jQuery(a).parent(),jQuery(r).parent());null==n?jQuery(t).append('<p class="error-message">Please select a value</p>'):""===o&&jQuery(a).append('<p class="error-message">This field must not be empty</p>')}),0!==jQuery("#filter-sage").find(".error-message").length&&e.preventDefault()}),jQuery("#all_filter_container .skeleton").remove();var f,m,v,g,h,_=Object.fromEntries(new URLSearchParams(window.location.search).entries()),w={};for(f in _)f.startsWith("filter_")&&(m=f.match(/\d+/)[0],v=f.match(/(?<=_)(.*?)(?=\[)/)[0],w.hasOwnProperty(m)||(w[m]={}),w[m][v]=_[f]);for([g,h]of Object.entries(w)){var b=n(),T=jQuery(b).find('select[name^="filter_field["]'),k=jQuery(b).find('select[name^="filter_type["]'),O=jQuery(b).find('input[name^="filter_value["]');jQuery(T).val(h.field),l(b),jQuery(k).val(h.type),jQuery(O).val(h.value),l(b)}if(_.hasOwnProperty("where_condition")&&jQuery("#where_condition").val(_.where_condition),t){try{t=new URL(t)}catch(e){t=null}if(t){let e="wss://"+t.host+"/ws",r=(console.log("start websocket",e),new WebSocket(e));r.onopen=()=>{console.log("ws.onopen"),r.send("hello world")},r.onmessage=e=>{console.log("ws.onmessage",e.data)},r.onerror=e=>{console.log("ws.onerror",e)},r.onclose=e=>{console.log("ws.onclose",e)}}}let S="";function x(e){var r=jQuery(e).closest("form"),t=jQuery('[id^="woocommerce_"][id$="_min_amount"]',r).closest("fieldset"),a=t.prev(),r=jQuery('[id^="woocommerce_"][id$="_ignore_discounts"]',r).closest("fieldset"),n=r.prev();"coupon"===jQuery(e).val()||""===jQuery(e).val()?(t.hide(),a.hide(),r.hide(),n.hide()):(t.show(),a.show(),r.show(),n.show())}jQuery(document).on("input",'[name="sage-fdocentete-dopiece"]',function(e){e=e.target;let l=jQuery(e).parent(),s=jQuery(l).find('[name="sage-fdocentete-dotype"]'),u=jQuery(l).find('[name="sage-fdocentete-wpnonce"]'),c=jQuery(l).find(".dashicons-yes"),y=jQuery(l).find(".dashicons-no"),p=jQuery(l).find("[data-order-fdocentete]"),f=(jQuery(l).find("div.notice").remove(),jQuery(c).addClass("hidden"),jQuery(y).addClass("hidden"),jQuery(p).prop("disabled",!0),jQuery(s).val(""),S=e.value,e.value);""!==S.trim()&&setTimeout(async()=>{if(f===S){var e=jQuery(l).find(".svg-spinner"),r=(jQuery(e).removeClass("hidden"),await fetch(j+"/index.php?rest_route="+encodeURI("/sage/v1/fdocentetes/"+encodeURIComponent(f))+"&_wpnonce="+jQuery(u).val()));if(f===S)if(jQuery(e).addClass("hidden"),200===r.status){e=await r.json();if(0===e.length)jQuery(y).removeClass("hidden");else if(1===e.length)jQuery(s).val(e[0].doType),jQuery(c).removeClass("hidden"),jQuery(p).prop("disabled",!1);else{jQuery(y).removeClass("hidden");var t,a=jQuery("<div class='notice notice-info'></div>").prependTo(l),n=(jQuery(a).append("<p>"+Q.sentences.multipleDoPieces+"</p>"),jQuery('<div class="d-flex flex-wrap"></div>').appendTo(a));for(t of e){let e="";for(var o in Q.fDocentetes.doType.values)if(Q.fDocentetes.doType.values[o].hasOwnProperty(t.doType)){e=Q.fDocentetes.doType.values[o][t.doType];break}jQuery(n).append('<div class="card cursor-pointer" data-select-sage-fdocentete-dotype="'+t.doType+'" style="max-width: none">'+e+"</div>")}}}else{jQuery(y).removeClass("hidden");try{var i=await r.json(),d=jQuery("<div class='notice notice-error'></div>").prependTo(l);jQuery(d).html("<pre>"+JSON.stringify(i,void 0,2)+"</pre>")}catch(e){console.error(e)}}}},500)}),jQuery(document).on("click","[data-select-sage-fdocentete-dotype]",function(e){var e=e.target,r=jQuery(e).closest(".notice").parent(),t=jQuery(r).find('[name="sage-fdocentete-dotype"]'),a=jQuery(r).find(".dashicons-yes"),n=jQuery(r).find(".dashicons-no"),o=jQuery(r).find("[data-order-fdocentete]");jQuery(r).find("div.notice").remove(),jQuery(t).val(jQuery(e).attr("data-select-sage-fdocentete-dotype")),jQuery(a).removeClass("hidden"),jQuery(n).addClass("hidden"),jQuery(o).prop("disabled",!1)}),jQuery(document).on("click","[data-order-fdocentete]",async function(e){var r=jQuery("[id^='woocommerce-order-sage']"),[t,a]=(jQuery(r).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c()),t=await fetch(j+"/index.php?rest_route="+encodeURI("/sage/v1/orders/"+t+"/fdocentete")+"&_wpnonce="+a,{method:"POST",body:JSON.stringify({"sage-fdocentete-dopiece":jQuery("#sage-fdocentete-dopiece").val(),"sage-fdocentete-dotype":jQuery("#sage-fdocentete-dotype").val()})});jQuery(r).unblock(),200===t.status&&(a=await t.json(),t=jQuery(r).find(".inside"),jQuery(t).html(a.html),jQuery("#woocommerce-order-items").trigger("wc_order_items_reload"),p())}),jQuery(document).on("click","[data-import-farticle]",async function(e){e.stopPropagation();var r=jQuery(e.target).closest("[id^='woocommerce-order']");jQuery(r).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let t=e.target;jQuery(t).attr("data-import-farticle")||(t=jQuery(t).closest("[data-import-farticle]"));var e=jQuery(t).attr("data-import-farticle"),a=jQuery(t).attr("data-order-id"),n=jQuery(t).attr("data-nonce"),e=await fetch(j+"/index.php?rest_route="+encodeURI("/sage/v1/farticle/"+e+"/import")+"&_wpnonce="+n+"&orderId="+a);jQuery(r).unblock(),200===e.status&&(n=await e.json(),a=jQuery(t).closest(".inside"),jQuery(a).html(n.html))}),jQuery(document).on("click","[data-synchronize-order]",async function(e){e.stopPropagation(),window.confirm(r.synchronizeOrder)&&y(!0)}),jQuery(document).on("click","[data-desynchronize-order]",async function(e){e.stopPropagation(),window.confirm(r.desynchronizeOrder)&&y(!1)}),jQuery(document.body).on("click",'a[href*="page=sage_"]',function(e){var r=JSON.parse(jQuery("[data-sage-default-filters]").attr("data-sage-default-filters")),t=URL.parse(jQuery(e.target).attr("href"),jQuery("[data-sage-admin-url]").attr("data-sage-admin-url"));let a=null;if(t.searchParams.forEach((e,r)=>{"page"===r&&(a=e)}),null!==a){for(var n of r)if(n.entityName===a){if(n.value)for(var[o,i]of Object.entries(n.value))for(var[d,l]of Object.entries(i))t.searchParams.append(o+"["+d+"]",l);break}jQuery(e.target).attr("href",t.href)}}),jQuery(document.body).on("change",'[id^="woocommerce_"][id$="_requires"]',function(){x(this)}),jQuery(document.body).on("order-totals-recalculate-complete",function(){y(!0)}),jQuery('[id^="woocommerce_"][id$="_requires"]').trigger("change"),jQuery(document.body).on("wc_backbone_modal_loaded",function(e,r){"wc-modal-shipping-method-settings"===r&&x(jQuery('#wc-backbone-modal-dialog [id^="woocommerce_"][id$="_requires"]',e.currentTarget))})});