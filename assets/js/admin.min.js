jQuery(document).ready(function(){let o=jQuery("#filters_container");var e=jQuery("[data-sage-translation]").attr("data-sage-translation");let p=[],t=(e&&(p=JSON.parse(e)),jQuery("[data-sage-api-host-url]").attr("data-sage-api-host-url"));e=new URL(location.href);e.searchParams.delete("sage_message"),window.history.replaceState(null,"",e);let i=0;function l(){return jQuery(o).children().length}function r(){var t,e=JSON.parse(jQuery("[data-all-fields]").attr("data-all-fields")),r=jQuery('<div class="filter-container" style="margin-bottom: 5px;display: flex;flex-wrap: wrap;"></div>').appendTo(o),a=jQuery("<div></div>").appendTo(r),n=(jQuery('<label class="screen-reader-text" for="filter_field['+i+']">filter_field[index]</label>').appendTo(a),jQuery('<select name="filter_field['+i+']" id="filter_field['+i+']"></select>').appendTo(a));jQuery("<option disabled selected value> -- select a field -- </option>").appendTo(n);for(t of e){let e=t.name;p[t.transDomain].hasOwnProperty(t.name)&&"string"!=typeof(e=p[t.transDomain][t.name])&&(e=e.label);jQuery('<option value="'+t.name+'">'+e+"</option>").appendTo(n)}var a=jQuery("<div></div>").appendTo(r),e=(jQuery('<label class="screen-reader-text" for="filter_type['+i+']">filter_type[index]</label>').appendTo(a),jQuery('<select disabled name="filter_type['+i+']" id="filter_type['+i+']"></select>').appendTo(a)),a=(jQuery("<option disabled selected value></option>").appendTo(e),jQuery("<div></div>").appendTo(r));jQuery('<label class="screen-reader-text" for="filter_value['+i+']">filter_value[index]</label>').appendTo(a),jQuery('<input disabled type="search" id="filter_value['+i+']" name="filter_value['+i+']" value="">').appendTo(a),jQuery('<span data-delete-filter class="dashicons dashicons-trash button" style="padding-right: 22px"></span>').appendTo(r);return i++,1<l()&&1!==jQuery("#where_condition").length&&(e=jQuery('<select name="where_condition" id="where_condition"></select>').appendTo("#or_and_container"),jQuery('<option value="or">or</option>').appendTo(e),jQuery('<option value="and">and</option>').appendTo(e)),r}function a(e){var t=JSON.parse(jQuery("[data-all-filter-type]").attr("data-all-filter-type")),r=JSON.parse(jQuery("[data-all-fields]").attr("data-all-fields"));let a=jQuery(e).find('select[name^="filter_field"]').val();var n=jQuery(e).find('select[name^="filter_type"]'),o=jQuery(e).find('input[name^="filter_value"]');jQuery(n).prop("disabled",!1),jQuery(o).prop("disabled",!1);let i=[];jQuery(n).find("option").each(function(e,t){i.push(jQuery(t).val())});o=t[r.find(e=>e.name===a).type];if(JSON.stringify(i)!==JSON.stringify(o)){jQuery(n).html("");for(var l of o){let e=l;p.words.hasOwnProperty(l)&&(e=p.words[l]);jQuery('<option value="'+l+'">'+e+"</option>").appendTo(n)}}d(e)}function s(e){var t=jQuery(e).find('input[name^="filter_value"]'),e=jQuery(e).find("select[data-filter-value-select]");jQuery(t).val(jQuery(e).val())}function d(e){var t=JSON.parse(jQuery("[data-all-fields]").attr("data-all-fields")),r=jQuery(e).find('input[name^="filter_value"]');let a=jQuery(e).find('select[name^="filter_field"]').val();var n=jQuery(e).find('select[name^="filter_type["]'),n=jQuery(n).val();let o="";["in","nin"].includes(n)&&(o="multiple");n=t.find(e=>e.name===a).values,t=jQuery(r).parent();jQuery(t).find("select").remove(),null!==n?(function t(r,a,n){for(var o in r){let e="";var i;n.includes(o.toString())&&(e='selected="selected"'),"string"==typeof r[o]?jQuery("<option "+e+' value="'+o+'">['+o+"]: "+r[o]+"</option>").appendTo(a):(i=jQuery('<optgroup label="'+o+'" />').appendTo(a),t(r[o],i,n))}}(n,jQuery("<select data-filter-value-select "+o+"></select>").appendTo(t),jQuery(r).val().split(",")),s(e)):jQuery(r).show()}jQuery(document).on("click","[data-2-select-target] option",function(e){var t=jQuery(e.target).closest("select");let r;var a=jQuery(t).attr("name");let n=!1;r=(void 0!==a&&!1!==a?(n=!0,jQuery(t).parent().prev()):jQuery(t).parent().next()).find("select");a=jQuery(e.target).detach().appendTo(r);jQuery(a).prop("selected",!1),n&&((t=r.children("option").get()).sort(function(e,t){return jQuery(e).text().toUpperCase().localeCompare(jQuery(t).text().toUpperCase())}),jQuery.each(t,function(e,t){r.append(t)}))}),jQuery(document).on("submit","#form_settings_sage",function(e){jQuery(e.target).find("[data-2-select-target] option").prop("selected",!0)}),jQuery(document).on("click",".sage-notice-dismiss",function(e){jQuery(e.target).closest("div.notice").remove()}),jQuery(document).on("click","#add_filter",function(e){r()}),jQuery(document).on("change",'select[name^="filter_field["]',function(e){a(jQuery(e.target).closest(".filter-container"))}),jQuery(document).on("change",'select[name^="filter_type["]',function(e){d(jQuery(e.target).closest(".filter-container"))}),jQuery(document).on("change","select[data-filter-value-select]",function(e){s(jQuery(e.target).closest(".filter-container"))}),jQuery(document).on("change",'select[name="per_page"]',function(e){jQuery(e.target).closest("form").submit()}),jQuery(document).on("click","[data-delete-filter]",function(e){jQuery(e.target).closest(".filter-container").remove(),l()<=1&&jQuery("#or_and_container").html("")}),jQuery(document).on("input","#filter-sage *",function(e){jQuery(jQuery(e.target).parent()).find(".error-message").remove()}),jQuery(document).on("submit","#filter-sage",function(e){jQuery("#filter-sage").find(".error-message").remove(),jQuery(".filter-container").each(function(e,t){var r=jQuery(t).find('select[name^="filter_field["]'),a=jQuery(t).find('select[name^="filter_type["]'),t=jQuery(t).find('input[name^="filter_value["]'),n=jQuery(r).val(),o=(jQuery(a).val(),jQuery(t).val().trim()),r=jQuery(r).parent(),a=(jQuery(a).parent(),jQuery(t).parent());null==n?jQuery(r).append('<p class="error-message">Please select a value</p>'):""===o&&jQuery(a).append('<p class="error-message">This field must not be empty</p>')}),0!==jQuery("#filter-sage").find(".error-message").length&&e.preventDefault()}),jQuery("#all_filter_container .skeleton").remove();var n,u,c,y,f,j=Object.fromEntries(new URLSearchParams(window.location.search).entries()),Q={};for(n in j)n.startsWith("filter_")&&(u=n.match(/\d+/)[0],c=n.match(/(?<=_)(.*?)(?=\[)/)[0],Q.hasOwnProperty(u)||(Q[u]={}),Q[u][c]=j[n]);for([y,f]of Object.entries(Q)){var m=r(),v=jQuery(m).find('select[name^="filter_field["]'),g=jQuery(m).find('select[name^="filter_type["]'),h=jQuery(m).find('input[name^="filter_value["]');jQuery(v).val(f.field),a(m),jQuery(g).val(f.type),jQuery(h).val(f.value),a(m)}if(j.hasOwnProperty("where_condition")&&jQuery("#where_condition").val(j.where_condition),t){try{t=new URL(t)}catch(e){t=null}if(t){console.log("start websocket","wss://"+t.host+"/Socket/ws");let e=new WebSocket("wss://"+t.host+"/ws");e.onopen=()=>{console.log("ws.onopen"),e.send("hello world")},e.onmessage=e=>{console.log("ws.onmessage",e.data)},e.onerror=e=>{console.log("ws.onerror",e)},e.onclose=e=>{console.log("ws.onclose",e)}}}let w="";function _(e){var t=jQuery(e).closest("form"),r=jQuery('[id^="woocommerce_"][id$="_min_amount"]',t).closest("fieldset"),a=r.prev(),t=jQuery('[id^="woocommerce_"][id$="_ignore_discounts"]',t).closest("fieldset"),n=t.prev();"coupon"===jQuery(e).val()||""===jQuery(e).val()?(r.hide(),a.hide(),t.hide(),n.hide()):(r.show(),a.show(),t.show(),n.show())}jQuery(document).on("input",'[name="sage-fdocentete-dopiece"]',function(e){e=e.target;let l=jQuery(e).parent(),s=jQuery(l).find('[name="sage-fdocentete-dotype"]'),d=jQuery(l).find('[name="sage-fdocentete-wpnonce"]'),u=jQuery(l).find(".dashicons-yes"),c=jQuery(l).find(".dashicons-no"),y=(jQuery(l).find("div.notice").remove(),jQuery(u).addClass("hidden"),jQuery(c).addClass("hidden"),jQuery(s).val(""),w=e.value,e.value);""!==w.trim()&&setTimeout(async()=>{if(y===w){var e=jQuery(l).find(".svg-spinner"),t=(jQuery(e).removeClass("hidden"),await fetch("/wp-json/sage/v1/fdocentetes/"+encodeURIComponent(y)+"?_wpnonce="+jQuery(d).val()));if(y===w)if(jQuery(e).addClass("hidden"),200===t.status){e=await t.json();if(0===e.length)jQuery(c).removeClass("hidden");else if(1===e.length)jQuery(s).val(e[0].doType),jQuery(u).removeClass("hidden");else{jQuery(c).removeClass("hidden");var r,a=jQuery("<div class='notice notice-info'></div>").prependTo(l),n=(jQuery(a).append("<p>"+p.sentences.multipleDoPieces+"</p>"),jQuery('<div class="d-flex flex-wrap"></div>').appendTo(a));for(r of e)jQuery(n).append('<div class="card cursor-pointer" data-select-sage-fdocentete-dotype="'+r.doType+'" style="max-width: none">'+p.fDocentetes.doType.values[r.doType]+"</div>")}}else{jQuery(c).removeClass("hidden");try{var o=await t.json(),i=jQuery("<div class='notice notice-error'></div>").prependTo(l);jQuery(i).html("<pre>"+JSON.stringify(o,void 0,2)+"</pre>")}catch(e){console.error(e)}}}},500)}),jQuery(document).on("click","[data-select-sage-fdocentete-dotype]",function(e){var e=e.target,t=jQuery(e).closest(".notice").parent(),r=jQuery(t).find('[name="sage-fdocentete-dotype"]'),a=jQuery(t).find(".dashicons-yes"),n=jQuery(t).find(".dashicons-no");jQuery(t).find("div.notice").remove(),jQuery(r).val(jQuery(e).attr("data-select-sage-fdocentete-dotype")),jQuery(a).removeClass("hidden"),jQuery(n).addClass("hidden")}),jQuery(document).on("click","[data-import-farticle]",async function(e){e.stopPropagation();var t=jQuery(e.target).closest("[id^='woocommerce-order']");jQuery(t).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let r=e.target;jQuery(r).attr("data-import-farticle")||(r=jQuery(r).closest("[data-import-farticle]"));var e=jQuery(r).attr("data-import-farticle"),a=jQuery(r).attr("data-order-id"),n=jQuery(r).attr("data-nonce"),e=await fetch("/wp-json/sage/v1/farticle/"+e+"/import?_wpnonce="+n+"&orderId="+a);jQuery(t).unblock(),200===e.status&&(n=await e.json(),a=jQuery(r).closest(".inside"),jQuery(a).html(n.html))}),jQuery(document).on("click","[data-synchronise-order]",async function(e){var t,r,a;e.stopPropagation(),window.confirm("todo 2eme ")&&(a=jQuery(e.target).closest("[id^='woocommerce-order']"),jQuery(a).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t=jQuery(e.target).attr("data-synchronise-order"),r=jQuery(e.target).attr("data-nonce"),t=await fetch("/wp-json/sage/v1/orders/"+t+"/sync?_wpnonce="+r),jQuery(a).unblock(),200===t.status)&&(r=await t.json(),a=jQuery(e.target).closest(".inside"),jQuery(a).html(r.html))}),jQuery(document.body).on("change",'[id^="woocommerce_"][id$="_requires"]',function(){_(this)}),jQuery('[id^="woocommerce_"][id$="_requires"]').trigger("change"),jQuery(document.body).on("wc_backbone_modal_loaded",function(e,t){"wc-modal-shipping-method-settings"===t&&_(jQuery('#wc-backbone-modal-dialog [id^="woocommerce_"][id$="_requires"]',e.currentTarget))})});